{"data":{"repository":{"pullRequest":{"reviewThreads":{"nodes":[{"id":"PRRT_kwDOQpnsbM5nowUW","isResolved":true,"comments":{"nodes":[{"author":{"login":"github-code-quality"},"body":"## Unused variable, import, function or class\n\nUnused variable cameraRef.\n\n---\n\nIn general, to fix an \"unused variable\" issue, either remove the variable if it is genuinely not needed, or start using it if it represents an intended but unimplemented behavior. Here, the component already manages the camera instance with the <code>camera</code> variable from <code>useMemo</code>, so maintaining a separate <code>cameraRef</code> that is never read or written provides no functionality.</p>\n<p>The best fix without changing existing behavior is to delete the <code>cameraRef</code> declaration on line 210. No other code references <code>cameraRef</code> in the provided snippet, so removing this line will not affect runtime behavior; it will simply clear the dead code flagged by CodeQL. No additional methods, imports, or definitions are required."}]}},{"id":"PRRT_kwDOQpnsbM5nowUZ","isResolved":true,"comments":{"nodes":[{"author":{"login":"github-code-quality"},"body":"## Unused variable, import, function or class\n\nUnused import beforeEach.\n\n---\n\nTo fix the problem, remove the unused <code>beforeEach</code> specifier from the <code>vitest</code> import so that all imported bindings are actually used. This keeps the file clean and avoids tooling warnings without altering test behavior.</p>\n<p>Concretely, in <code>src/components/camera/__tests__/fixed-perspective.test.tsx</code>, edit the import on line 7 to drop <code>beforeEach</code> from the destructuring import. No other changes, new methods, or additional imports are required."}]}},{"id":"PRRT_kwDOQpnsbM5nowUd","isResolved":true,"comments":{"nodes":[{"author":{"login":"github-code-quality"},"body":"## Unused variable, import, function or class\n\nUnused import vi.\n\n---\n\nTo fix the problem, remove <code>vi</code> from the named imports from <code>vitest</code> so that only the actually used bindings are imported. This eliminates the unused import without changing any functionality.</p>\n<p>Concretely, in <code>src/components/parallax/__tests__/useParallax.test.ts</code>, update the import statement on line 7 from <code>import { describe, expect, it, vi } from 'vitest';</code> to <code>import { describe, expect, it } from 'vitest';</code>. No additional imports, methods, or definitions are needed."}]}},{"id":"PRRT_kwDOQpnsbM5nowUg","isResolved":true,"comments":{"nodes":[{"author":{"login":"github-code-quality"},"body":"## Unused variable, import, function or class\n\nUnused import beforeEach.\n\n---\n\nTo fix an unused import, either remove it or start using it. Since there is no apparent need for <code>beforeEach</code> in these tests and adding artificial usage would only add noise, the best fix is to remove <code>beforeEach</code> from the import list, keeping the rest of the import intact.</p>\n<p>Concretely, in <code>src/components/parallax/__tests__/parallax.test.tsx</code>, update the <code>vitest</code> import on line 8 to remove <code>beforeEach</code> while leaving <code>describe</code>, <code>expect</code>, <code>it</code>, and <code>vi</code> unchanged. No additional methods, imports, or definitions are required; we are only editing the named import list."}]}},{"id":"PRRT_kwDOQpnsbM5nowUj","isResolved":true,"comments":{"nodes":[{"author":{"login":"github-code-quality"},"body":"## Unused variable, import, function or class\n\nUnused variable fogColorObj.\n\n---\n\n<p>In general, to fix an unused variable warning, either remove the declaration if it is truly unused, or update the code to use it if it was intended to participate in the logic. Here, the memoized <code>fogColorObj</code> is not read anywhere in the shown code and has no side effects, so it can be safely removed without changing existing behavior.</p>\n<p>The best minimal fix is to delete the <code>useMemo</code> block that defines <code>fogColorObj</code> (lines 90–94) while leaving the rest of the hook intact. This does not require any changes to other logic, definitions, or imports. Although <code>useMemo</code> then becomes unused in the imports, we are not allowed to modify imports except via shown snippets, and the reported CodeQL issue is specifically for <code>fogColorObj</code>; addressing that variable is sufficient for this fix.</p>\n<p>Concretely:</p>\n<ul>\n<li>In <code>src/components/parallax/useParallax.ts</code>, remove the comment <code>// Memoize fog color</code> and the <code>const fogColorObj = useMemo(...);</code> block (lines 90–94).</li>\n<li>No new methods, imports, or definitions are needed.</li>\n</ul>"}]}},{"id":"PRRT_kwDOQpnsbM5nowzD","isResolved":true,"comments":{"nodes":[{"author":{"login":"cursor"},"body":"### Utility function crashes with 'custom' preset and no angles\n\n<!-- **High Severity** -->\n\n<!-- DESCRIPTION START -->\nThe `getCameraPosition` utility function crashes when called with `preset='custom'` but without providing `customAngles`. The conditional `preset === 'custom' && customAngles` evaluates to falsy when `customAngles` is undefined, causing it to fall through to `PRESETS[preset]`. Since 'custom' is explicitly excluded from `PRESETS` (via `Exclude<PerspectivePreset, 'custom'>`), this returns `undefined`, and destructuring `{ yaw, pitch }` from `undefined` throws a TypeError. The component handles this correctly with an explicit check, but the exported utility function does not.\n<!-- DESCRIPTION END -->\n\n<!-- LOCATIONS START\nsrc/components/camera/FixedPerspectiveCamera.tsx#L349-L351\nLOCATIONS END -->\n<a href=\"https://cursor.com/open?data=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImJ1Z2JvdC12MiJ9.eyJ2ZXJzaW9uIjoxLCJ0eXBlIjoiQlVHQk9UX0ZJWF9JTl9DVVJTT1IiLCJkYXRhIjp7InJlZGlzS2V5IjoiYnVnYm90OjY1NmY2NmVmLTdiZjAtNDBlZi1iMDAzLTYxYjg2YmM3YTg0OSIsImVuY3J5cHRpb25LZXkiOiJUY0R2ZlNYMUdzTl8wRmROWldMd21neEpRRGlkNWp5WjV2RWJuU2gzdzdNIiwiYnJhbmNoIjoiZmVhdC9maXhlZC1wZXJzcGVjdGl2ZS1wYXJhbGxheCJ9LCJpYXQiOjE3NjcxMTA2MTMsImV4cCI6MTc2OTcwMjYxM30.P4_k0ycmyKrUs3ACEZCzlkrsZ6prIkTS0hmrC3HEA7dwP51sLfAkerBp7Cy1T6cT9h6c0V51Z-bQ6VEkxzutMOxYzMwQju8FPWPdlM183pPWQ4seoqP36rlIz7kIB-qBMqONm7RNa5PdiPd7FSmyFsl2ucW6pggfKt6hBeQmfX8duGrdjY-GX3-orWW2Q5AyGODXAG-VftqYMC8TQZ_XZJpY3kXpI8C5hhZtjtX2pQKVn6jWiLxXm5xnftKKWPeYLULbhJuKLhQ6SnR071RK-wfDS6JfSHYaUFOiQbicc9wMmQOXmF7zS0-6rJJhcGmYeLZtOjDSr-A76R0_ZNPZ-A\" target=\"_blank\" rel=\"noopener noreferrer\"><picture><source media=\"(prefers-color-scheme: dark)\" srcset=\"https://cursor.com/fix-in-cursor-dark.svg\"><source media=\"(prefers-color-scheme: light)\" srcset=\"https://cursor.com/fix-in-cursor-light.svg\"><img alt=\"Fix in Cursor\" src=\"https://cursor.com/fix-in-cursor.svg\"></picture></a>&nbsp;<a href=\"https://cursor.com/agents?data=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImJ1Z2JvdC12MiJ9.eyJ2ZXJzaW9uIjoxLCJ0eXBlIjoiQlVHQk9UX0ZJWF9JTl9XRUIiLCJkYXRhIjp7InJlZGlzS2V5IjoiYnVnYm90OjY1NmY2NmVmLTdiZjAtNDBlZi1iMDAzLTYxYjg2YmM3YTg0OSIsImVuY3J5cHRpb25LZXkiOiJUY0R2ZlNYMUdzTl8wRmROWldMd21neEpRRGlkNWp5WjV2RWJuU2gzdzdNIiwiYnJhbmNoIjoiZmVhdC9maXhlZC1wZXJzcGVjdGl2ZS1wYXJhbGxheCIsInJlcG9Pd25lciI6InN0cmF0YS1nYW1lLWxpYnJhcnkiLCJyZXBvTmFtZSI6ImNvcmUiLCJwck51bWJlciI6MTMzLCJjb21taXRTaGEiOiJmNzM4YjJiNjEwNDcyNzgyNWY4Njg2OTdkNzUzMGRmYmY2YzBhYmIwIiwicHJvdmlkZXIiOiJnaXRodWIifSwiaWF0IjoxNzY3MTEwNjEzLCJleHAiOjE3Njk3MDI2MTN9.XFCMOnyu34LKTD4eE0uqEQfrcj5QFsfjK-eOZbPlUeasvgAUj2of_OPv8NiVms-X4cD9h6YMPDzvCFXEwCAkJ5IUa7i5ikyZVTP2IF_xboxUZB0UhS7qYbNjGzj0BoKrq2Iq0zNyJD2xCmrMcgrV69CdfEyLdqBk0dk0jQqle_hoLu23BiqLaQtgGbfEZz2Vyhf1OUedywhnXKmZf5FRwfFjBt6pYYzKqRNg7EUbpQ1RTZ667MDF4--EbUJUBqgcBbS7BgREzpRlh-WTd9gU64tjcE5sUFnfudQXZBi6bD-Aqn3ypVXOLz6BNWRcrjeKeKZbTCqwz34K56uIKzi6Xg\" target=\"_blank\" rel=\"noopener noreferrer\"><picture><source media=\"(prefers-color-scheme: dark)\" srcset=\"https://cursor.com/fix-in-web-dark.svg\"><source media=\"(prefers-color-scheme: light)\" srcset=\"https://cursor.com/fix-in-web-light.svg\"><img alt=\"Fix in Web\" src=\"https://cursor.com/fix-in-web.svg\"></picture></a>\n\n"}]}},{"id":"PRRT_kwDOQpnsbM5nowzF","isResolved":true,"comments":{"nodes":[{"author":{"login":"cursor"},"body":"### Camera roll not applied during follow target updates\n\n<!-- **Medium Severity** -->\n\n<!-- DESCRIPTION START -->\nWhen using `followTarget` with a non-zero `roll`, the roll angle is only applied once in the initial `useEffect` but never reapplied in the `useFrame` callback. Since `camera.lookAt()` resets the camera's orientation each frame, any configured `roll` rotation gets overwritten during follow updates. Users combining `followTarget` and `roll` props will see their roll angle ignored after the first frame.\n<!-- DESCRIPTION END -->\n\n<!-- LOCATIONS START\nsrc/components/camera/FixedPerspectiveCamera.tsx#L297-L327\nLOCATIONS END -->\n<a href=\"https://cursor.com/open?data=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImJ1Z2JvdC12MiJ9.eyJ2ZXJzaW9uIjoxLCJ0eXBlIjoiQlVHQk9UX0ZJWF9JTl9DVVJTT1IiLCJkYXRhIjp7InJlZGlzS2V5IjoiYnVnYm90OmQwMGNlYzkyLTg1YjYtNGVjMi05YWYxLTZhNDc5OTdlMzJhOSIsImVuY3J5cHRpb25LZXkiOiJwZXM1VmJRbDcyQW43cVZrYkY1WWRZWF9XQjlkWFlyaHJkWVBCOVVhcmtvIiwiYnJhbmNoIjoiZmVhdC9maXhlZC1wZXJzcGVjdGl2ZS1wYXJhbGxheCJ9LCJpYXQiOjE3NjcxMTA2MTMsImV4cCI6MTc2OTcwMjYxM30.WWMU_WDDpK183J6iOKXqCLZW56ClHbMTPaLNTkmMsrMByi7nbDInXGqn5ApeGFhvKKGN2gaRCiCnEHTBPDXSbOubU8qC8Q41xrr95mvINj2HU44Mn3dDRbg5i6bkOaN-40JOVWbOZLUtA4jghAdmYFTPzH5sVlDpmsQ5RUBa1vhS2_IalKq3twCeCzKlkF2s9GykvlFq7fkWYzIomlzplfrRbWFu8YTwRwDbskUzTLd_8yBw3zi1ii03SsHSrv0wY2QnA5ckizuoW2yrhUME-Vka1_LEVPGXfJ2G_VkGycwtGjhoJFC6r1sfiFZj9aGs-JVxCHz8RUISrAior6UDCw\" target=\"_blank\" rel=\"noopener noreferrer\"><picture><source media=\"(prefers-color-scheme: dark)\" srcset=\"https://cursor.com/fix-in-cursor-dark.svg\"><source media=\"(prefers-color-scheme: light)\" srcset=\"https://cursor.com/fix-in-cursor-light.svg\"><img alt=\"Fix in Cursor\" src=\"https://cursor.com/fix-in-cursor.svg\"></picture></a>&nbsp;<a href=\"https://cursor.com/agents?data=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImJ1Z2JvdC12MiJ9.eyJ2ZXJzaW9uIjoxLCJ0eXBlIjoiQlVHQk9UX0ZJWF9JTl9XRUIiLCJkYXRhIjp7InJlZGlzS2V5IjoiYnVnYm90OmQwMGNlYzkyLTg1YjYtNGVjMi05YWYxLTZhNDc5OTdlMzJhOSIsImVuY3J5cHRpb25LZXkiOiJwZXM1VmJRbDcyQW43cVZrYkY1WWRZWF9XQjlkWFlyaHJkWVBCOVVhcmtvIiwiYnJhbmNoIjoiZmVhdC9maXhlZC1wZXJzcGVjdGl2ZS1wYXJhbGxheCIsInJlcG9Pd25lciI6InN0cmF0YS1nYW1lLWxpYnJhcnkiLCJyZXBvTmFtZSI6ImNvcmUiLCJwck51bWJlciI6MTMzLCJjb21taXRTaGEiOiJmNzM4YjJiNjEwNDcyNzgyNWY4Njg2OTdkNzUzMGRmYmY2YzBhYmIwIiwicHJvdmlkZXIiOiJnaXRodWIifSwiaWF0IjoxNzY3MTEwNjEzLCJleHAiOjE3Njk3MDI2MTN9.Izms6Dr14Vky730391l_StzehuyaG4qFU28tmKij6Lvv6YWYPAjXMjx9J2kHeiu9IymRJcpe9afAjCYwJZgE4oOp6an9cuYiDp7Ouh0S2hcsoZS8NMtC7kh92Tpvto0hrLivOt54nxLnanAEIlrFOl5oF2T_e1B9R2mYHLd7OabvG6twEjTdqutBFpSJXa470bNWaxyao5HNPsLTEhNjEgIZCkNzlcbZYCH3IXMS43rGfBLzIzPsQZ5Djie6gLjv224C8yYIKl6etSblqFnT9qsopg69A_Nu0-coGtxdDOFpwqe20x2QGaVIdrciFmngP6mTkqWzNFws3V_c79FrWQ\" target=\"_blank\" rel=\"noopener noreferrer\"><picture><source media=\"(prefers-color-scheme: dark)\" srcset=\"https://cursor.com/fix-in-web-dark.svg\"><source media=\"(prefers-color-scheme: light)\" srcset=\"https://cursor.com/fix-in-web-light.svg\"><img alt=\"Fix in Web\" src=\"https://cursor.com/fix-in-web.svg\"></picture></a>\n\n"}]}},{"id":"PRRT_kwDOQpnsbM5nowzI","isResolved":false,"comments":{"nodes":[{"author":{"login":"cursor"},"body":"### Content width mismatch causes parallax tiling misalignment\n\n<!-- **High Severity** -->\n\n<!-- DESCRIPTION START -->\nThe `contentWidth` in the layer config and the width passed to element generation functions are computed from separate `rng.int()` calls. Since the seeded RNG is stateful and advances with each call, these produce different values. For mountain layers, `contentWidth: 512 + rng.int(0, 256)` differs from the width passed to `generateMountainSilhouette`. The same issue affects foliage layers. This causes the repeat/tiling calculations to use an incorrect width, resulting in visible seams or gaps when layers tile horizontally.\n<!-- DESCRIPTION END -->\n\n<!-- LOCATIONS START\nsrc/components/parallax/ProceduralBackground.tsx#L174-L185\nsrc/components/parallax/ProceduralBackground.tsx#L200-L204\nLOCATIONS END -->\n<details>\n<summary>Additional Locations (1)</summary>\n\n- [`src/components/parallax/ProceduralBackground.tsx#L200-L204`](https://github.com/strata-game-library/core/blob/f738b2b6104727825f868697d7530dfbf6c0abb0/src/components/parallax/ProceduralBackground.tsx#L200-L204)\n\n</details>\n\n<a href=\"https://cursor.com/open?data=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImJ1Z2JvdC12MiJ9.eyJ2ZXJzaW9uIjoxLCJ0eXBlIjoiQlVHQk9UX0ZJWF9JTl9DVVJTT1IiLCJkYXRhIjp7InJlZGlzS2V5IjoiYnVnYm90OmNlMzgyNWI1LWU5NmMtNGRiMS05NzJmLWU2ZmFjM2IzODY0ZiIsImVuY3J5cHRpb25LZXkiOiJxMkNPWUt4Ni1Xbm5hUG9zLWw2Mm5lV3ZhYXg4TXd5RE55V2k0ODVfMTlnIiwiYnJhbmNoIjoiZmVhdC9maXhlZC1wZXJzcGVjdGl2ZS1wYXJhbGxheCJ9LCJpYXQiOjE3NjcxMTA2MTMsImV4cCI6MTc2OTcwMjYxM30.ozDTpNnZFB-856tECy_WTx9VTSdn-Tk0oGr0_Mhizaqajh1j1sumvNJs28W471CGA3A9I_Gyvs_v4Bqy8q4JE0rD4YO3bceXb2xFVN5mhR9f6690U8217QmSO6hHHWZmt5jukEopAQeC9wsPgj5RUEP138tSkOZBWokjG-ldY0cSqIk3pt_X2aG2bESZScI61NeFRJXdR8IFJ0m_i2Dlz_ieWYwXWi9WxaKqtNtTL8v9vxuWux7L9lZ3Z4BEVG_TVy83pmuA-TvoM38aIMcYi9fSN0pSkh0o9RQZfrjoTMMihnIbRuHTKsI_hDQLTqUM2xXm8jQrHvShRdu5GKAmSQ\" target=\"_blank\" rel=\"noopener noreferrer\"><picture><source media=\"(prefers-color-scheme: dark)\" srcset=\"https://cursor.com/fix-in-cursor-dark.svg\"><source media=\"(prefers-color-scheme: light)\" srcset=\"https://cursor.com/fix-in-cursor-light.svg\"><img alt=\"Fix in Cursor\" src=\"https://cursor.com/fix-in-cursor.svg\"></picture></a>&nbsp;<a href=\"https://cursor.com/agents?data=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImJ1Z2JvdC12MiJ9.eyJ2ZXJzaW9uIjoxLCJ0eXBlIjoiQlVHQk9UX0ZJWF9JTl9XRUIiLCJkYXRhIjp7InJlZGlzS2V5IjoiYnVnYm90OmNlMzgyNWI1LWU5NmMtNGRiMS05NzJmLWU2ZmFjM2IzODY0ZiIsImVuY3J5cHRpb25LZXkiOiJxMkNPWUt4Ni1Xbm5hUG9zLWw2Mm5lV3ZhYXg4TXd5RE55V2k0ODVfMTlnIiwiYnJhbmNoIjoiZmVhdC9maXhlZC1wZXJzcGVjdGl2ZS1wYXJhbGxheCIsInJlcG9Pd25lciI6InN0cmF0YS1nYW1lLWxpYnJhcnkiLCJyZXBvTmFtZSI6ImNvcmUiLCJwck51bWJlciI6MTMzLCJjb21taXRTaGEiOiJmNzM4YjJiNjEwNDcyNzgyNWY4Njg2OTdkNzUzMGRmYmY2YzBhYmIwIiwicHJvdmlkZXIiOiJnaXRodWIifSwiaWF0IjoxNzY3MTEwNjEzLCJleHAiOjE3Njk3MDI2MTN9.gkdosoLH7ENspzSr_BOxtBAwsP0Au8lVXNjh5Ba533fjC61HXtc5huYZf40RUcog5CumLIlKcME80Lomlv0uziyp9ZutePRlnp10sl6cy0zHN0i7sbXg2BiWGVzehEvovUbxHwWk8XlQDnfDH4V4EQB7wUqfdWLDqA_sgfu672rvycTmEbcQi53kAb6qaDlwaDMYa9VkpzQqAsC4zB_F-crCBZ68jFhiAlvTIvugF99ENnOUSccG2sOoKbzf_ECeyFYT7nzBDwr9bds7cLEEQSJ9N_bgwDIsBnF-2Sb5jg-RSKbabw2sJsC8Qd8pNCYxtjZQLXpXFj6bxMDNzsAl5Q\" target=\"_blank\" rel=\"noopener noreferrer\"><picture><source media=\"(prefers-color-scheme: dark)\" srcset=\"https://cursor.com/fix-in-web-dark.svg\"><source media=\"(prefers-color-scheme: light)\" srcset=\"https://cursor.com/fix-in-web-light.svg\"><img alt=\"Fix in Web\" src=\"https://cursor.com/fix-in-web.svg\"></picture></a>\n\n"}]}},{"id":"PRRT_kwDOQpnsbM5nowzJ","isResolved":false,"comments":{"nodes":[{"author":{"login":"cursor"},"body":"### Target prop changes ignored after initial mount\n\n<!-- **Medium Severity** -->\n\n<!-- DESCRIPTION START -->\nThe `target` prop is captured in a ref at mount time but never updated when the prop changes. The `useEffect` that positions the camera reads from `currentTarget.current` but doesn't include `target` in its dependency array. This means updating the `target` prop after initial render has no effect on the camera position, silently ignoring the new value unless `followTarget` is being used.\n<!-- DESCRIPTION END -->\n\n<!-- LOCATIONS START\nsrc/components/camera/FixedPerspectiveCamera.tsx#L229-L230\nsrc/components/camera/FixedPerspectiveCamera.tsx#L252-L277\nLOCATIONS END -->\n<details>\n<summary>Additional Locations (1)</summary>\n\n- [`src/components/camera/FixedPerspectiveCamera.tsx#L252-L277`](https://github.com/strata-game-library/core/blob/f738b2b6104727825f868697d7530dfbf6c0abb0/src/components/camera/FixedPerspectiveCamera.tsx#L252-L277)\n\n</details>\n\n<a href=\"https://cursor.com/open?data=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImJ1Z2JvdC12MiJ9.eyJ2ZXJzaW9uIjoxLCJ0eXBlIjoiQlVHQk9UX0ZJWF9JTl9DVVJTT1IiLCJkYXRhIjp7InJlZGlzS2V5IjoiYnVnYm90OjAwZmY5OGMyLTc3MmYtNDJiYy1iOWJiLWI2NzQ1YzMxOGE0NCIsImVuY3J5cHRpb25LZXkiOiJ6dGx3Mi03aVRYT01oX3RyaS1OM2hFbkRiT3ZsYXM4UlRXSDFqMURER0d3IiwiYnJhbmNoIjoiZmVhdC9maXhlZC1wZXJzcGVjdGl2ZS1wYXJhbGxheCJ9LCJpYXQiOjE3NjcxMTA2MTMsImV4cCI6MTc2OTcwMjYxM30.CpjKn15f1fgkshwNzVoyHlIFi0jb-wT9eOQaqoKliLTqZTUk7ZzqYNJIQ0KRsQg0fT1P8PbJmPuYIz3UBymPGj_Ay7YMaKvqeVlsDMxe-jOL9vUUYraEzstombRsY6oPhyVzhdpFdiV2uvpu34VjfwsFE7YH4qExICc6vFPwkYaGUQ8B7b4M--gpUFJGjaX_b6AnfAUV-tRnkZ2NkyxAiEmF-klw3jJr9vHmu6aZ_EN0eZGlspFp-pKiPTQQUTQc0MuMnhqT3BDQ5WMn8FFoKR2VtX84bHG-kJ7ah7LdOgbpahzQDrrN1bjV6JG1Q-AtiiNYeQj9z64yFUKqvjEuIg\" target=\"_blank\" rel=\"noopener noreferrer\"><picture><source media=\"(prefers-color-scheme: dark)\" srcset=\"https://cursor.com/fix-in-cursor-dark.svg\"><source media=\"(prefers-color-scheme: light)\" srcset=\"https://cursor.com/fix-in-cursor-light.svg\"><img alt=\"Fix in Cursor\" src=\"https://cursor.com/fix-in-cursor.svg\"></picture></a>&nbsp;<a href=\"https://cursor.com/agents?data=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImJ1Z2JvdC12MiJ9.eyJ2ZXJzaW9uIjoxLCJ0eXBlIjoiQlVHQk9UX0ZJWF9JTl9XRUIiLCJkYXRhIjp7InJlZGlzS2V5IjoiYnVnYm90OjAwZmY5OGMyLTc3MmYtNDJiYy1iOWJiLWI2NzQ1YzMxOGE0NCIsImVuY3J5cHRpb25LZXkiOiJ6dGx3Mi03aVRYT01oX3RyaS1OM2hFbkRiT3ZsYXM4UlRXSDFqMURER0d3IiwiYnJhbmNoIjoiZmVhdC9maXhlZC1wZXJzcGVjdGl2ZS1wYXJhbGxheCIsInJlcG9Pd25lciI6InN0cmF0YS1nYW1lLWxpYnJhcnkiLCJyZXBvTmFtZSI6ImNvcmUiLCJwck51bWJlciI6MTMzLCJjb21taXRTaGEiOiJmNzM4YjJiNjEwNDcyNzgyNWY4Njg2OTdkNzUzMGRmYmY2YzBhYmIwIiwicHJvdmlkZXIiOiJnaXRodWIifSwiaWF0IjoxNzY3MTEwNjEzLCJleHAiOjE3Njk3MDI2MTN9.U1ztzZ-MwPT4iluu0bcuj5fV2RvtjoxNKxL16mXvSsE8TMuaYncrzzCy-Zl8MuR8UXJQ_ERgGPhJ1Zgx23eP25qtFYWFNp8k65i9AzDO50GcuKTOaD99kDno8TuDH48KdKnsTJHUFclZ_SNnLiulYi_HNy-ulpzqwz5SoXSld94mrgozoA01LYQihzn324nvgenZc9fiHtsgwABS1E6UIGZp7wq8_JAi3fczi5KTs2ASUeV0264fA7Vxtn6lS8XdRQOc6P-GFd2PDntldRL-9L-jujG-1d78YLi-y3ZgGbf-aw_LIN1MevpcV7oGFF7cmwa4AwTaBVM-mntn1dRs6g\" target=\"_blank\" rel=\"noopener noreferrer\"><picture><source media=\"(prefers-color-scheme: dark)\" srcset=\"https://cursor.com/fix-in-web-dark.svg\"><source media=\"(prefers-color-scheme: light)\" srcset=\"https://cursor.com/fix-in-web-light.svg\"><img alt=\"Fix in Web\" src=\"https://cursor.com/fix-in-web.svg\"></picture></a>\n\n"}]}},{"id":"PRRT_kwDOQpnsbM5noxWw","isResolved":true,"comments":{"nodes":[{"author":{"login":"gemini-code-assist"},"body":"![critical](https://www.gstatic.com/codereviewagent/critical.svg)\n\nThe function name `screenToWorld` and its JSDoc imply that it converts screen pixel coordinates (e.g., from a mouse event) to world coordinates. However, the implementation expects `screenX` and `screenY` to be in Normalized Device Coordinates (NDC), which range from -1 to 1. This is misleading and will produce incorrect results if pixel coordinates are passed in directly. \n\nTo fix this, you should either:\n1. Rename the function to `ndcToWorld` to accurately reflect its behavior.\n2. Update the function to accept screen coordinates and the viewport dimensions, and perform the conversion to NDC internally. For example:\n\n```typescript\n// Inside the function\nconst ndc = new THREE.Vector2(\n  (screenX / viewport.width) * 2 - 1,\n  -(screenY / viewport.height) * 2 + 1\n);\n```"}]}},{"id":"PRRT_kwDOQpnsbM5noxWy","isResolved":true,"comments":{"nodes":[{"author":{"login":"gemini-code-assist"},"body":"![critical](https://www.gstatic.com/codereviewagent/critical.svg)\n\nThe `ParallaxBackground` component's `layers` prop is not functional. The `ParallaxLayerRenderer` component is called for each layer configuration, but it only renders an empty `<group>`. The comments `// Layer content would be rendered here based on config` and `// This is a placeholder...` confirm that this implementation is incomplete. As a result, if a developer uses the `layers` prop, no content will be rendered for the parallax background."}]}},{"id":"PRRT_kwDOQpnsbM5noxW1","isResolved":true,"comments":{"nodes":[{"author":{"login":"gemini-code-assist"},"body":"![critical](https://www.gstatic.com/codereviewagent/critical.svg)\n\nThere is a fundamental design issue in how `ParallaxLayer` is implemented. It uses its own `useFrame` hook to calculate its position based on the global camera state (`state.camera.position`). This conflicts with the `ParallaxBackground` component, which is designed to control the parallax effect via its `scrollX` and `scrollY` props.\n\nThis creates two disconnected parallax systems. For these components to work together as intended, `ParallaxLayer` should not manage its own position. Instead, it should receive its position from `ParallaxBackground` via props or a React context. This ensures a single source of truth for the scroll position and improves performance by centralizing the update logic in the parent component."}]}},{"id":"PRRT_kwDOQpnsbM5noxW3","isResolved":true,"comments":{"nodes":[{"author":{"login":"gemini-code-assist"},"body":"![critical](https://www.gstatic.com/codereviewagent/critical.svg)\n\nThe `ProceduralBackgroundComponent` is currently non-functional as it does not render any visual elements. It generates layer data but then maps over it to create a series of empty `<group>` elements, only populating their `userData`. The comments confirm this is a placeholder. To be usable, this component needs to render the actual geometry or sprites defined in the `elements` array of the generated layers, likely by integrating with `ParallaxBackground` and a proper rendering mechanism."}]}},{"id":"PRRT_kwDOQpnsbM5noxW5","isResolved":true,"comments":{"nodes":[{"author":{"login":"gemini-code-assist"},"body":"![high](https://www.gstatic.com/codereviewagent/high-priority.svg)\n\nThere's a potential crash condition here. If `preset` is `'custom'` but `customAngles` is not provided, `PRESETS[preset as keyof typeof PRESETS]` will be `PRESETS['custom']`, which is `undefined`. Attempting to destructure `yaw` and `pitch` from `undefined` will throw a `TypeError`. You should add a check to handle this case, for example by throwing an error or providing default values."}]}},{"id":"PRRT_kwDOQpnsbM5noxW7","isResolved":true,"comments":{"nodes":[{"author":{"login":"gemini-code-assist"},"body":"![high](https://www.gstatic.com/codereviewagent/high-priority.svg)\n\nThe props `affectedByDayNight` and `dayNightColors` are defined for the `ParallaxLayer` component but are never used within its implementation. The logic for applying day/night tinting exists in `ParallaxLayerRenderer` (in `ParallaxBackground.tsx`), but not here. This makes these props non-functional when `ParallaxLayer` is used directly as a child, which is misleading for the component's API."}]}},{"id":"PRRT_kwDOQpnsbM5noxW8","isResolved":true,"comments":{"nodes":[{"author":{"login":"gemini-code-assist"},"body":"![high](https://www.gstatic.com/codereviewagent/high-priority.svg)\n\nThe `useMemo` hook will re-execute `generateBackgroundLayers` on every render of `ProceduralBackgroundComponent`. This is because the `config` object is recreated on every render due to the `...config` spread in the parent component's props. This is highly inefficient, as layer generation can be a heavy operation.\n\nTo fix this, you should destructure the properties from `config` and list them individually in the `useMemo` dependency array. This will ensure that `generateBackgroundLayers` is only called when the relevant configuration properties actually change."}]}},{"id":"PRRT_kwDOQpnsbM5noxW-","isResolved":true,"comments":{"nodes":[{"author":{"login":"gemini-code-assist"},"body":"![high](https://www.gstatic.com/codereviewagent/high-priority.svg)\n\nThe `startOffset` calculation for repeating content appears to be incorrect for creating a seamless loop with buffer tiles. It is calculated as `-normalizedScroll`, which means at `scrollX = 0`, the first tile starts at `0`. However, the `count` is `ceil(...) + 2`, implying one buffer tile is needed on each side. When scrolling backwards from `0`, there will be no tile to the left, causing a visual gap.\n\nThe offset should likely account for this prepended buffer tile. A common approach is to set the offset to `-normalizedScroll - contentWidth` and adjust the loop accordingly. This ensures there is always content visible before the main viewport area.\n\n```suggestion\n    const startOffset = -normalizedScroll - contentWidth;\n```"}]}},{"id":"PRRT_kwDOQpnsbM5noxXC","isResolved":true,"comments":{"nodes":[{"author":{"login":"gemini-code-assist"},"body":"![medium](https://www.gstatic.com/codereviewagent/medium-priority.svg)\n\nA new `THREE.Vector3` is being created from `followOffset` on every frame within the `useFrame` hook. This is inefficient as it can lead to increased garbage collection and impact performance, especially in a function that runs on every render. It's better to create this vector once outside the hook and update it if necessary.\n\n```suggestion\n        targetPos.add(new THREE.Vector3().fromArray(followOffset));\n```"}]}},{"id":"PRRT_kwDOQpnsbM5noxXD","isResolved":true,"comments":{"nodes":[{"author":{"login":"gemini-code-assist"},"body":"![medium](https://www.gstatic.com/codereviewagent/medium-priority.svg)\n\nThe props `baseWidth` and `baseHeight` are defined and accepted by the `ParallaxBackground` component, but they are never used. This can be confusing for developers using this component. These props should either be implemented to affect scaling or removed if they are not needed."}]}},{"id":"PRRT_kwDOQpnsbM5noxXE","isResolved":true,"comments":{"nodes":[{"author":{"login":"gemini-code-assist"},"body":"![medium](https://www.gstatic.com/codereviewagent/medium-priority.svg)\n\nThe parallax `speedFactor` is calculated using a hardcoded multiplier of `0.2` to relate depth to speed. This limits the customizability of the parallax effect. This value should be exposed as a configurable option in `UseParallaxOptions` to allow developers to fine-tune the parallax feel.\n\n```suggestion\n            const speedFactor = 1 / (1 + depth * (options.depthSpeedFactor ?? 0.2));\n```"}]}}]}}}}}
